{% extends "webapp/base.html" %}
{% load staticfiles %}
{% load i18n %}

{% block container %}
    <!-- Start Recipe -->
    <!-- Column Left -->

    <div class="col-md-8 col-md-offset-2">
    <h1 class="recipe-name">Homemade strawberry lollipop</h1>

    <div class="panel main-picture-padding row">
        <div id="carousel-example-generic" class="main-picture-carousel carousel slide"
             data-ride="carousel">
            <!-- Indicators -->
            <ol class="carousel-indicators">
                <li data-target="#carousel-example-generic" data-slide-to="0" class="active"></li>
                <li data-target="#carousel-example-generic" data-slide-to="1"></li>
                <li data-target="#carousel-example-generic" data-slide-to="2"></li>
            </ol>

            <!-- Wrapper for slides -->
            <div class="carousel-inner">
                <div class="item active">
                    <img src="http://www.cocinillas.es/wp-content/uploads/2011/05/DSC08380-1600x1200.jpg">

                    <div class="carousel-caption"></div>
                </div>
                <div class="item">
                    <img src="http://www.cocinillas.es/wp-content/uploads/2011/05/DSC08373-1600x1200.jpg">

                    <div class="carousel-caption"></div>
                </div>
                <div class="item">
                    <img src="http://www.cocinillas.es/wp-content/uploads/2011/05/DSC08371-1600x1200.jpg">

                    <div class="carousel-caption"></div>
                </div>
            </div>

            <!-- Controls -->
            <a class="left carousel-control" href="#carousel-example-generic" data-slide="prev">
                <span class="glyphicon glyphicon-chevron-left"></span>
            </a>
            <a class="right carousel-control" href="#carousel-example-generic" data-slide="next">
                <span class="glyphicon glyphicon-chevron-right"></span>
            </a>
        </div>

        <!-- Author overlay -->
        <a class="recipe-author-link" href="#">
            <img class="img-circle recipe-author recipe-author-picture"
                 src="https://lh5.googleusercontent.com/-OiRh2CnezSw/U1A_gITdD4I/AAAAAAAASss/dauhnw6AtSw/w608-h609-no/004recortada.jpg">
            <h5 class="recipe-author recipe-author-name">By Virgi</h5>
        </a>

        <!-- Votes overaly -->
        <div class="recipe-votes-container">
            <div class="recipe-votes">
                <div class="recipe-votes-indicators">
                    <span class="recipe-votes-indicator"><i class="fa fa-thumbs-up"></i>456</span>
                    <span class="recipe-votes-indicator"><i class="fa fa-thumbs-down"></i>3</span>
                    <span class="recipe-votes-count">534</span>
                </div>

                <div class="progress recipe-votes-progress">
                    <div class="progress-bar progress-bar-success" style="width: 90%">
                    </div>
                    <div class="progress-bar progress-bar-warning" style="width: 10%">
                    </div>
                </div>

                <div class="recipe-votes-buttons">
                    <a class="btn btn-default recipe-votes-like-btn"><i class="fa fa-thumbs-up"></i> Like</a>
                    <a class="btn btn-default recipe-votes-like-btn"><i class="fa fa-thumbs-down"></i></a>
                </div>

            </div>
        </div>
    </div>

    <div class="panel panel-body row recipe-description">
        <p class="text-soft">Unas piruletas caseras de azúcar la mar de ricas y fáciles de hacer, del sabor que más
            os guste, que volverán locos a los más peques de la casa. </p>
    </div>

    <div class="panel panel-body row">
        <div class="col-md-4 recipe-data">
            {% comment %}<p>30 + 10 min</p>
                <p class="recipe-data-secondary">prep + cook time</p>{% endcomment %}
            <p>30 min</p>

            <p class="recipe-data-secondary">prep time</p>
        </div>
        <div class="col-md-4 recipe-data">
            <p>Easy</p>

            <p class="recipe-data-secondary">difficulty</p>
        </div>
        <div class="col-md-4 recipe-data">
            <p>4 units</p>

            <p class="recipe-data-secondary">serves</p>
        </div>
    </div>

    <div class="row">
        <div class="col-md-6 recipe-ingredients-parent">
            <div class="{% comment %}panel{% endcomment %} panel-body recipe-ingredients post-it-left">
                <h3 class="recipe-panel-title">Ingredients</h3>
                <ul>
                    <li>200g de azúcar</li>
                    <li>80ml de agua</li>
                    <li>Esencia (la que más nos guste)</li>
                    <li>Colorante alimenticio</li>
                    <li>Virutitas para decorar</li>
                </ul>
            </div>
        </div>
        <div class="col-md-6 recipe-notes-parent">
            <div class="{% comment %}panel {% endcomment %}panel-body recipe-notes postit">
                <h3 class="recipe-panel-title">Notes</h3>

                <p>Esta es una receta que os hará quedar bien con los más peques de la casa. Generalmente a los
                    niños les encanta, además si les ponéis colores llamativos les va a llamar mucho la atención y
                    se divertirán más comiéndolas.</p>
            </div>
        </div>
    </div>

    <div class="recipe-step-list">
        <div id="step-1" class="recipe-step">
            <div class="row">
                <div class="col-md-1 col-md-offset-1 recipe-step-count">1</div>
                <div class="col-md-9">
                    <p class="text-soft">Ponemos en un cazo el azúcar con el agua a fuego medio y removemos de vez
                        en
                        cuando
                        hasta que hierva. Tapamos el cazo y lo dejamos hirviendo unos 3 minutos.</p>
                </div>
            </div>
        </div>

        <span class="recipe-step-separator center-block"></span>

        <div id="step-2" class="recipe-step">
            <div class="row">
                <div class="col-md-1 col-md-offset-1 recipe-step-count">2</div>
                <div class="col-md-9">
                    <p class="text-soft">Cuando veamos que espese un poco y oscurezca el color le ponemos el
                        colorante
                        que
                        queramos y la esencia. Si queréis hacerlas de fresa, yo lo que hago es ponerle en vez de
                        esencia
                        un
                        poco
                        de sirope de fresa, que da color y sabor.</p>
                </div>
            </div>
            <img class="img-rounded recipe-step-picture img-thumbnail center-block"
                 src="http://www.cocinillas.es/wp-content/uploads/2011/05/DSC08373-1600x1200.jpg">
        </div>

        <span class="recipe-step-separator center-block"></span>

        <div id="step-3" class="recipe-step">
            <div class="row">
                <div class="col-md-1 col-md-offset-1 recipe-step-count">3</div>
                <div class="col-md-9">
                    <p class="text-soft">Ponemos el cazo dentro de la cacerola que habíamos preparado con agua, para
                        así
                        detener la cocción, y lo sacamos rápidamente para que no nos enfríe mucho el cazo.</p>
                </div>
            </div>
        </div>

        <span class="recipe-step-separator center-block"></span>

        <div id="step-4" class="recipe-step">
            <div class="row">
                <div class="col-md-1 col-md-offset-1 recipe-step-count">4</div>
                <div class="col-md-9">
                    <p class="text-soft">Con una cuchara de metal vamos poniendo el contenido encima de nuestro
                        mármol o
                        de nuestro papel, haciendo formas de piruletas (círculos de unos 4cm de ancho).</p>
                </div>
            </div>
            <img class="img-rounded recipe-step-picture img-thumbnail center-block"
                 src="http://www.cocinillas.es/wp-content/uploads/2011/05/DSC08372-1600x1200.jpg">
        </div>

        <span class="recipe-step-separator center-block"></span>

        <div id="step-5" class="recipe-step">
            <div class="row">
                <div class="col-md-1 col-md-offset-1 recipe-step-count">5</div>
                <div class="col-md-9">
                    <p class="text-soft">Le echamos virutitas por encima y ya está. Dejamos secar nuestras piruletas
                        un par de horas y listo. ¡A comer! :)</p>
                </div>
            </div>
        </div>
    </div>

    <div class="row">
        <div class="col-md-6 recipe-more-parent">
            <div class="panel panel-body recipe-more">
                <h3 class="recipe-panel-title">More information</h3>

                <div class="recipe-more-title">Occasions:</div>
                <span><a class="recipe-tag" href="#">Christmas</a></span>
                <span><a class="recipe-tag" href="#">St. Valentine's</a></span>
                <span><a class="recipe-tag" href="#">Other stuff's day</a></span>

                <div class="recipe-more-title">Food Type:</div>
                <span><a class="recipe-tag" href="#">Desert</a></span>
                <span><a class="recipe-tag" href="#">Candy</a></span>

                <div class="recipe-more-title">Suitable for:</div>
                <span><a class="recipe-tag" href="#">Celiac</a></span>
                <span><a class="recipe-tag" href="#">Vegetarian</a></span>

                <div class="recipe-more-title">Tags:</div>
                <span><a class="recipe-tag" href="#">Candy</a></span>
                <span><a class="recipe-tag" href="#">Yummy</a></span>
                <span><a class="recipe-tag" href="#">Kids</a></span>
                <span><a class="recipe-tag" href="#">Strawberry</a></span>


            </div>
        </div>
        <div class="col-md-6 recipe-tastes-parent">
            <div class="panel panel-body recipe-tastes">
                <h3 class="recipe-panel-title">Savours</h3>

                <div class="recipe-tastes-list">
                    <div class="recipe-taste">
                        <span>Salty</span>

                        <div class="progress">
                            <div class="progress-bar" id="salty" role="progressbar" aria-valuenow="60" aria-valuemin="0"
                                 aria-valuemax="100" style="width: {{ receta.savours.salty }}%;">
                            </div>
                        </div>
                    </div>
                    <div class="recipe-taste">
                        <span>Sour</span>

                        <div class="progress">
                            <div class="progress-bar" id="sour" role="progressbar" aria-valuenow="80" aria-valuemin="0"
                                 aria-valuemax="100" style="width: {{ receta.savours.sour }}%;">
                            </div>
                        </div>
                    </div>
                    <div class="recipe-taste">
                        <span>Bitter</span>

                        <div class="progress">
                            <div class="progress-bar" id="bitter" role="progressbar" aria-valuenow="60"
                                 aria-valuemin="0"
                                 aria-valuemax="100" style="width: {{ receta.savours.bitter }}%;">
                            </div>
                        </div>
                    </div>
                    <div class="recipe-taste">
                        <span>Sweet</span>

                        <div class="progress">
                            <div class="progress-bar" id="sweet" role="progressbar" aria-valuenow="60" aria-valuemin="0"
                                 aria-valuemax="100" style="width: 90%;">
                            </div>
                        </div>
                    </div>
                    <div class="recipe-taste">
                        <span>Spicy</span>

                        <div class="progress">
                            <div class="progress-bar" id="spicy" role="progressbar" aria-valuenow="60" aria-valuemin="0"
                                 aria-valuemax="100" style="width: {{ receta.savours.spicy }}%;">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="row panel panel-body">
        <h3 class="recipe-panel-title">Comments</h3>

        <div class="recipe-comment-list">
            {% for i in "1234" %}
                <div class="recipe-comment">
                    <img class="img-circle recipe-comment-picture"
                         src="https://lh5.googleusercontent.com/-OiRh2CnezSw/U1A_gITdD4I/AAAAAAAASss/dauhnw6AtSw/w608-h609-no/004recortada.jpg">

                    <span class="recipe-comment-name">Virgi Moriel</span>
                    <span class="recipe-comment-date">18 de Abril de 2014 a las 00:13</span>

                    <p class="text-soft"> Creo que ya puedo pasarme a confirmarlo: ¡están riquísimas! Aunque no han
                        quedado
                        demasiado perfectas (lo que tiene ser principiante) son completamente comestibles y están muy
                        buenas.</p>
                </div>
                {% if not forloop.last %}
                    <hr>
                {% endif %}
            {% endfor %}

            <div class="recipe-comment-form">
                <img class="img-circle recipe-comment-picture"
                     src="https://lh5.googleusercontent.com/-OiRh2CnezSw/U1A_gITdD4I/AAAAAAAASss/dauhnw6AtSw/w608-h609-no/004recortada.jpg">

                <div class="recipe-comment-form-input">
                    <form method="POST" action="{% url 'comment' receta.id %}">
                        <div class="comment-form">
                            <div class="comment-bocadillo">
                                <div class="bocadillo-efecto efecto-inferior"></div>
                                <div class="bocadillo-efecto efecto-superior"></div>
                            </div>
                            <textarea class="col-md-12" type="text" name="text"
                                      placeholder="Escriba un comentario..." rows="4"></textarea>
                        </div>
                        <input class="plus btn btn-default" type="submit">
                    </form>
                </div>
            </div>

        </div>
    </div>


    </div>
{% endblock %}

{% block custom_js %}
    <script>
        var csrftoken = getCookie('csrftoken');

        // establecer valores por defecto utilizados en las peticiones ajax
        $.ajaxSetup({
            crossDomain: false, // obviates need for sameOrigin test
            //especificar pretratamiento del XMLHTTPRequest (en este caso, añadir cabecera CSRF)
            beforeSend: function (xhr, settings) {
                if (!csrfSafeMethod(settings.type)) {
                    xhr.setRequestHeader("X-CSRFToken", csrftoken);
                }
            }
        });

        // funcion a ejecutar cuando el DOM este completamente cargado
        $(document).ready(function () {
            var $positive = $("#btn-positive");
            var $negative = $("#btn-negative");
            var $positive_votes = $("#positive_votes")
            var $negative_votes = $("#negative_votes")
            var $error = $("#error-vote");
            var $ok = $("#ok-vote");

            // por defecto los divs para indicar el resultado estan ocultos
            $error.hide();
            $ok.hide();

            // establece una función a ejecutar cuando se haga click sobre el elemento
            $positive.click(function (e) {
                var data = {"recipe": '{{ receta.id }}', "type": "positive"};

                $.ajax({    // Realizar peticion ajax
                    type: "POST",
                    url: '{% url 'vote' %}',
                    data: data,
                    dataType: "json",

                    // funcion ejecutada cuando la peticion haya tenido exito
                    success: function (jqXHR, textStatus, errorThrown) {
                        $error.hide();

                        $ok.show();

                        //actualizar conteo de votos sin necesidad de recargar la pagina
                        $.get('{% url 'recipe_votes' receta.id %}', function (data) {
                            var result = $.parseJSON(data);

                            console.log("votos tras la votacion\n +: " + result.positives + "\n -: " + result.negatives);
                            $positive_votes.html(result.positives)
                            $negative_votes.html(result.negatives)

                            //$positive.attr("disabled", true);
                            //$negative.attr("disabled", true);
                        })
                    },

                    // funcion ejecutada cuando se haya producido algun error
                    error: function (jqXHR, textStatus, errorThrown) {
                        var result = $.parseJSON(jqXHR.responseText);

                        $error.find("span").html(result.message);
                        $error.show();

                        $ok.hide();
                    }
                })
            });

            $negative.click(function (e) {
                var data = {"recipe": '{{ receta.id }}', "type": "negative"};

                $.ajax({
                    type: "POST",
                    url: '{% url 'vote' %}',
                    data: data,
                    dataType: "json",
                    success: function (jqXHR, textStatus, errorThrown) {

                        var $error = $("#error-vote");
                        $error.hide();

                        var $ok = $("#ok-vote");
                        $ok.show();

                        //actualizar conteo de votos sin necesidad de recargar la pagina
                        $.get('{% url 'recipe_votes' receta.id %}', function (data) {
                            var result = $.parseJSON(data);

                            console.log("votos tras la votacion\n +: " + result.positives + "\n -: " + result.negatives);
                            $positive_votes.html(result.positives)
                            $negative_votes.html(result.negatives)

                            //$positive.attr("disabled", true);
                            //$negative.attr("disabled", true);
                        })
                    },

                    error: function (jqXHR, textStatus, errorThrown) {
                        var result = $.parseJSON(jqXHR.responseText);

                        var $error = $("#error-vote");
                        $error.find("span").html(result.message);
                        $error.show();

                        var $ok = $("#ok-vote");
                        $ok.hide();
                    }
                })
            })
        });

        function getCookie(name) {
            var cookieValue = null;
            if (document.cookie && document.cookie != '') {
                var cookies = document.cookie.split(';');
                for (var i = 0; i < cookies.length; i++) {
                    var cookie = jQuery.trim(cookies[i]);
                    // Does this cookie string begin with the name we want?
                    if (cookie.substring(0, name.length + 1) == (name + '=')) {
                        cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                        break;
                    }
                }
            }
            return cookieValue;
        }
        function csrfSafeMethod(method) {
            // these HTTP methods do not require CSRF protection
            return (/^(GET|HEAD|OPTIONS|TRACE)$/.test(method));
        }
    </script>
    <script>
        $().ready(function () {
            $(".recipe-author-link").hover(
                    function () {
                        $(".recipe-author").addClass("hover");
                    },
                    function () {
                        $(".recipe-author").removeClass("hover");
                    }
            );

            //XXX Cuidado, valores puestos a mano. Se podría animar con una clase usando jQueryUI
            $(".recipe-votes-container").hover(
                    function () {
                        $(".recipe-votes").animate({"margin-bottom": 0})
                    },
                    function () {
                        $(".recipe-votes").animate({"margin-bottom": "-40px"})
                    }
            );

            var $commentForm = $(".recipe-comment-form textarea");
            var $input = $(".comment-bocadillo, .comment-form");
            $commentForm.focusin(
                    function () {
                        $input.css("background-color", "#fefefe")
                    }
            );
            $commentForm.focusout(
                    function () {
                        $input.css("background-color", "#e9e9e9")
                    }
            );
        });
    </script>
{% endblock %}