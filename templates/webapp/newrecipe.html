{% extends "webapp/index.html" %}
{% load staticfiles %}
{% load i18n %}


{% block custom_css %}
    <link href="{% static 'webapp/css/bootstrap-select.min.css' %}" rel="stylesheet">
    <link href="{% static 'webapp/css/slider.css' %}" rel="stylesheet">
{% endblock %}


{% block custom_js %}
    <script src="{% static 'webapp/js/bootstrap-slider.js' %}"></script>
    <script src="{% static 'webapp/js/bootstrap-select.min.js' %}"></script>
    <script src="{% static 'webapp/js/repeatable-fields.js' %}"></script>
    <script src="{% static 'webapp/js/jquery-ui-1.10.4.custom.min.js' %}"></script>
    <script type="text/javascript">
        $().ready(function () {
            $('select').selectpicker(); //TODO ¿Poner esto en toda la web y ya está?
            $('.slider').slider();
            jQuery(function () {
                jQuery('.repeat').each(function () {
                    jQuery(this).repeatable_fields();
                });
            });
        });
    </script>
{% endblock %}

{% block container %}
    <h1>New Recipe</h1>

    <form role="form well well-lg" class="form-horizontal" method="post" enctype="multipart/form-data">
    {% csrf_token %}

    {% comment %}TODO: poner cada error en su campo
    {% endcomment %}
    {% for field in form %}
        {% for error in field.errors %}
            <div class="alert alert-danger">{{ error|escape }}</div>
        {% endfor %}
    {% endfor %}

    {{ form.non_field_errors }}

    <legend>General information</legend>
    <fieldset class="well">

    <!-- Title -->
    <div class="form-group">
        <label for="id_{{ form.title.name }}"
               class="col-sm-2 control-label">{{ form.title.label }}</label>

        <div class="col-sm-3">
            {% comment %}
                    Utilizo esta técnica en vez de poner {{ form.username }} para permitir estilos personalizados.
                    Se pueden añadir estilos en la clase NewAccountForm, pero de esta forma es más flexible y deja la
                    visualización como responsabilidad de la plantilla.
                    Visto en: http://stackoverflow.com/questions/18805999/how-to-style-a-django-form-bootstrap
                    {% endcomment %}
            <input type="text" class="form-control" placeholder="Username"
                   name="{{ form.title.name }}" id="id_{{ form.title.name }}"
                   value="{{ form.title.value | default_if_none:'' }}">
        </div>
        <span class="help-block">Required</span>
    </div>

    <!-- Main Image -->
    <div class="form-group">
        <label for="id_{{ form.main_image.name }}"
               class="col-sm-2 control-label">{{ form.main_image.label }}</label>

        <div class="col-sm-3">
            <input type="file" class="form-control" placeholder="Username"
                   name="{{ form.main_image.name }}" id="id_{{ form.main_image.name }}">
        </div>
        <span class="help-block">Required</span>
    </div>


    <!-- Description -->
    <div class="form-group">
        <label for="id_{{ form.description.name }}"
               class="col-sm-2 control-label">{{ form.description.label }}</label>

        <div class="col-sm-3">
            <textarea class="form-control"
                      name="{{ form.description.name }}" id="id_{{ form.description.name }}"
                      value="{{ form.description.value | default_if_none:'' }}"></textarea>
        </div>
        <span class="help-block">Required</span>
    </div>

    <!-- Ingredients -->
    <div class="form-group">
        <label for="id_{{ form.ingredients.name }}"
               class="col-sm-2 control-label">{{ form.ingredients.label }}</label>

        <div class="col-sm-8">
                <div class="repeat">
                    {% verbatim %}
                    <table class="wrapper table table-striped table-bordered">
                        <thead>
                        <tr>
                            <td width="10%" colspan="4"><span class="add btn btn-success">Add</span></td>
                        </tr>
                        </thead>
                        <tbody class="container ui-sortable">
                        <tr class="template row">
                            <td width="10%"><span class="move btn btn-info">Move</span></td>

                            <td width="80%">
                                <dl>
                                    <dd><input type="text" name="ingredient[{{row-count-placeholder}}]"
                                               class="form-control"></dd>
                                </dl>
                            </td>
                            <td width="10%"><span class="remove btn btn-danger">Remove</span></td>
                        </tr>
                        </tbody>
                    </table>
                    {% endverbatim %}
                </div>
        </div>
        <span class="help-block">Required</span>
    </div>

    <!-- Serves -->
    <div class="form-group">
        <label for="id_{{ form.serves.name }}"
               class="col-sm-2 control-label">{{ form.serves.label }}</label>

        <div class="col-sm-3">
            <input type="password" class="form-control" placeholder="Repeat your password"
                   name="{{ form.serves.name }}" id="id_{{ form.serves.name }}"
                   value="{{ form.serves.value | default_if_none:'' }}">
        </div>
        <span class="help-block">Required</span>
    </div>

    <!-- Difficult -->
    <div class="form-group">
        <label for="id_{{ form.difficult.name }}"
               class="col-sm-2 control-label">{{ form.difficult.label }}</label>

        <div class="col-sm-3">

            <select class="form-control show-tick"
                    id="id_{{ form.difficult.name }}" name="{{ form.difficult.name }}">
                {% for choice in form.difficult.field.choices %}
                    {% comment %}TODO Opción preseleccionada!!!{% endcomment %}
                    <option value="{{ choice.0 }}">{{ choice.1 }}</option>
                {% endfor %}
            </select>
        </div>
        <span class="help-block">Required</span>
    </div>

    <!-- Food type -->
    <div class="form-group">
        <label for="id_{{ form.food_type.name }}"
               class="col-sm-2 control-label">{{ form.food_type.label }}</label>

        <div class="col-sm-3">

            <select class="form-control show-tick"
                    id="id_{{ form.food_type.name }}" name="{{ form.food_type.name }}">
                {% for choice in form.food_type.field.choices %}
                    {% comment %}TODO Opción preseleccionada!!!{% endcomment %}
                    <option value="{{ choice.0 }}">{{ choice.1 }}</option>
                {% endfor %}
            </select>
        </div>
        <span class="help-block">Required</span>
    </div>

    <!-- Language -->
    <div class="form-group">
        <label for="id_{{ form.language.name }}"
               class="col-sm-2 control-label">{{ form.language.label }}</label>

        <div class="col-sm-3">

            <select class="form-control show-tick"
                    id="id_{{ form.language.name }}" name="{{ form.language.name }}">
                {% for choice in form.language.field.choices %}
                    {% comment %}TODO Opción preseleccionada!!!{% endcomment %}
                    <option value="{{ choice.0 }}">{{ choice.1 }}</option>
                {% endfor %}
            </select>
        </div>
        <span class="help-block">Required</span>
    </div>

    <!-- Nationality -->
    <div class="form-group">
        <label for="id_{{ form.nationality.name }}"
               class="col-sm-2 control-label">{{ form.nationality.label }}</label>

        <div class="col-sm-3">

            <select class="form-control show-tick"
                    id="id_{{ form.nationality.name }}" name="{{ form.nationality.name }}">
                {% for choice in form.nationality.field.choices %}
                    {% comment %}TODO Opción preseleccionada!!!{% endcomment %}
                    <option value="{{ choice.0 }}">{{ choice.1 }}</option>
                {% endfor %}
            </select>
        </div>
        <span class="help-block">Required</span>
    </div>

    <!-- Temporality -->
    <div class="form-group">
        <label for="id_{{ form.temporality.name }}"
               class="col-sm-2 control-label">{{ form.temporality.label }}</label>

        <div class="col-sm-3">
            <select class="form-control show-tick" multiple data-live-search="true"
                    id="id_{{ form.temporality.name }}" name="{{ form.temporality.name }}">
                {% for choice in form.temporality.field.choices %}
                    <option value="{{ choice.0 }}">{{ choice.1 }}</option>
                {% endfor %}
            </select>
        </div>
    </div>

    <!-- Special Conditions -->
    <div class="form-group">
        <label for="id_{{ form.special_conditions.name }}"
               class="col-sm-2 control-label">{{ form.special_conditions.label }}</label>

        <div class="col-sm-3">
            <select class="form-control show-tick" multiple data-live-search="true"
                    id="id_{{ form.special_conditions.name }}" name="{{ form.special_conditions.name }}">
                {% for choice in form.special_conditions.field.choices %}
                    <option value="{{ choice.0 }}">{{ choice.1 }}</option>
                {% endfor %}
            </select>
        </div>
    </div>

    <!-- Tags -->
    <div class="form-group">
        <label for="id_{{ form.tags.name }}"
               class="col-sm-2 control-label">{{ form.tags.label }}</label>

        <div class="col-sm-3">
            <input type="text" class="form-control" placeholder="Your public name"
                   name="{{ form.tags.name }}" id="id_{{ form.tags.name }}"
                   value="{{ form.tags.value | default_if_none:'' }}">
        </div>
        <span class="help-block">Required</span>
    </div>

    <!-- Notes -->
    <div class="form-group">
        <label for="id_{{ form.notes.name }}"
               class="col-sm-2 control-label">{{ form.notes.label }}</label>

        <div class="col-sm-3">
            <textarea class="form-control"
                      name="{{ form.notes.name }}" id="id_{{ form.notes.name }}"
                      value="{{ form.notes.value | default_if_none:'' }}"></textarea>
        </div>
        <span class="help-block">Required</span>
    </div>
    </fieldset>

    <legend>Consumer preferences</legend>
    <fieldset class="well">
        <!-- Special conditions -->

        <!-- Tastes -->
        <div class="col-sm-5">
            <h3>Tastes</h3>
            <label for="id_{{ form.salty.name }}" class="slider-label">{{ form.salty.label }}</label>

            <div class="control-group">
                <input type="number" class="form-control slider"
                       name="{{ form.salty.name }}" id="id_{{ form.salty.name }}"
                       data-slider-min="0"
                       data-slider-max="99"
                       data-slider-value="{{ form.salty.value | default_if_none:'50' }}"
                       data-slider-tooltip="hide"
                       data-slider-id="salty"
                        >
            </div>

            <div class="control-group">
                <label for="id_{{ form.sour.name }}" class="slider-label">{{ form.sour.label }}</label>
                <input type="number" class="form-control slider"
                       name="{{ form.sour.name }}" id="id_{{ form.sour.name }}"
                       data-slider-min="0"
                       data-slider-max="99"
                       data-slider-value="{{ form.sour.value | default_if_none:'50' }}"
                       data-slider-tooltip="hide"
                       data-slider-id="sour"
                        >
            </div>

            <div class="control-group">
                <label for="id_{{ form.bitter.name }}" class="slider-label">{{ form.bitter.label }}</label>
                <input type="number" class="form-control slider"
                       name="{{ form.bitter.name }}" id="id_{{ form.bitter.name }}"
                       data-slider-min="0"
                       data-slider-max="99"
                       data-slider-value="{{ form.bitter.value | default_if_none:'50' }}"
                       data-slider-tooltip="hide"
                       data-slider-id="bitter"
                        >
            </div>

            <div class="control-group">
                <label for="id_{{ form.sweet.name }}" class="slider-label">{{ form.sweet.label }}</label>
                <input type="number" class="form-control slider"
                       name="{{ form.sweet.name }}" id="id_{{ form.sweet.name }}"
                       data-slider-min="0"
                       data-slider-max="99"
                       data-slider-value="{{ form.sweet.value | default_if_none:'50' }}"
                       data-slider-tooltip="hide"
                       data-slider-id="sweet"
                        >
            </div>

            <div class="control-group">
                <label for="id_{{ form.spicy.name }}" class="slider-label">{{ form.spicy.label }}</label>
                <input type="number" class="form-control slider"
                       name="{{ form.spicy.name }}" id="id_{{ form.spicy.name }}"
                       data-slider-min="0"
                       data-slider-max="99"
                       data-slider-value="{{ form.spicy.value | default_if_none:'50' }}"
                       data-slider-tooltip="hide"
                       data-slider-id="spicy"
                        >
            </div>

            <div id="steps-div">
                <textarea id="steps" style="display:none" name="steps"></textarea>
            </div>
        </div>
    </fieldset>

    <legend>Steps</legend>
    <fieldset class="well">
        <div class="repeat">
            {% verbatim %}
            <table class="wrapper table table-striped table-bordered">
                <thead>
                <tr>
                    <td width="10%" colspan="4"><span class="add btn btn-success">Add</span></td>
                </tr>
                </thead>
                <tbody class="container ui-sortable">
                <tr class="template row">
                    <td width="10%"><span class="move btn btn-info">Move</span></td>

                    <td width="80%">
                        <dl>
                            <dt>Description</dt>
                            <dd><textarea name="step[{{row-count-placeholder}}][description]"
                                          class="form-control"></textarea></dd>

                            <dt>Image</dt>
                            <dd><input type="file" name="step[{{row-count-placeholder}}][image]"
                                       class="form-control"></dd>
                        </dl>
                    </td>
                    <td width="10%"><span class="remove btn btn-danger">Remove</span></td>
                </tr>
                </tbody>
            </table>
            {% endverbatim %}
        </div>
    </fieldset>

    <!-- Submit Button -->
    <div class="form-group">
        <label for="inputDisplayName" class="col-sm-1 control-label"></label>

        <div class="col-sm-3">
            <input type="submit" class="btn btn-success" value="Create account"/>
        </div>
    </div>
    </form>
{% endblock %}
